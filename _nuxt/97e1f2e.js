(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{264:function(t,e,n){"use strict";n.r(e);n(39),n(31),n(58),n(59);var o=n(25),c=(n(38),n(14),n(27),n(184),n(47),n(32),n(71),n(41),n(255));function r(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function l(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?r(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):r(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var d={data:function(){return{locationUser:{},leaflet:{},bikeData:[],availabilityBikeData:[],locationBikeData:[],availabilityLocationBikeData:[],nowCityName:"請選擇城市",cacheSearch:"",cities:[{name:"臺北市",nameEn:"Taipei",coordinate:{latitude:25.0462,longitude:121.5174}},{name:"新北市",nameEn:"NewTaipei",coordinate:{latitude:25.0143926,longitude:121.4639425}},{name:"桃園市",nameEn:"Taoyuan",coordinate:{latitude:24.989306,longitude:121.3133955}},{name:"臺中市",nameEn:"Taichung",coordinate:{latitude:24.136941,longitude:120.685056}},{name:"臺南市",nameEn:"Tainan",coordinate:{latitude:22.997212,longitude:120.212319}},{name:"高雄市",nameEn:"Kaohsiung",coordinate:{latitude:22.6384542,longitude:120.3019452}},{name:"新竹市",nameEn:"Hsinchu",coordinate:{latitude:24.801841,longitude:120.9715962}},{name:"苗栗縣",nameEn:"MiaoliCounty",coordinate:{latitude:24.5699868,longitude:120.8223152}},{name:"嘉義市",nameEn:"Chiayi",coordinate:{latitude:23.4791004,longitude:120.4413128}},{name:"屏東縣",nameEn:"PingtungCounty",coordinate:{latitude:22.669248,longitude:120.4861926}},{name:"金門縣",nameEn:"KinmenCounty",coordinate:{latitude:24.409293,longitude:118.297844}}],markers:null,searchMarker:null}},computed:{filterBikeData:function(){var t=this;return this.bikeData.filter((function(e){return e.StationName.Zh_tw.match(t.cacheSearch)}))}},created:function(){this.leaflet=n(256);var t=n(258);this.leaflet=l(l({},this.leaflet),t)},mounted:function(){this.getUserPosition()},methods:{getUserPosition:function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(this.success,this.error)},success:function(t){this.locationUser={latitude:t.coords.latitude,longitude:t.coords.longitude},this.myMap=this.leaflet.map("mapID",{center:[t.coords.latitude,t.coords.longitude],zoom:14}),this.leaflet.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoidmljMzMzIiwiYSI6ImNrdXRqNHBjbTVwa3Myb21uc3hrajJkeHEifQ.TeelvbEBo9SIQjYpUdv70g"}).addTo(this.myMap),this.leaflet.circle([this.locationUser.latitude,this.locationUser.longitude],{radius:1e3}).addTo(this.myMap),this.leaflet.marker([this.locationUser.latitude,this.locationUser.longitude],{icon:this.setIconColor("blue")}).addTo(this.myMap)},error:function(){alert("無法取得你的位置")},getBikeData:function(t){var e=this,n="https://ptx.transportdata.tw/MOTC/v2/Bike/Station/".concat(t,"?$format=JSON"),o="https://ptx.transportdata.tw/MOTC/v2/Bike/Availability/".concat(t,"?$format=JSON");this.$axios.get(n,{headers:this.getAuthorizationHeader()}).then((function(t){e.bikeData=t.data,e.$axios.get(o,{headers:e.getAuthorizationHeader()}).then((function(t){e.availabilityBikeData=t.data,e.bikeData.forEach((function(t,n){e.availabilityBikeData.forEach((function(o){t.StationUID===o.StationUID&&(e.bikeData[n]=l(l({},t),o))}))})),e.renderBikeData(e.bikeData)}))}))},getLocationBikeData:function(){var t=this,e="https://ptx.transportdata.tw/MOTC/v2/Bike/Station/NearBy?$spatialFilter=nearby(".concat(this.locationUser.latitude,"%2C%20").concat(this.locationUser.longitude,"%2C%201000)&$format=JSON"),n="https://ptx.transportdata.tw/MOTC/v2/Bike/Availability/NearBy?$spatialFilter=nearby(".concat(this.locationUser.latitude,"%2C%20").concat(this.locationUser.longitude,"%2C%201000)&$format=JSON");this.$axios.get(e,{headers:this.getAuthorizationHeader()}).then((function(e){t.locationBikeData=e.data,t.$axios.get(n,{headers:t.getAuthorizationHeader()}).then((function(e){t.availabilityBikeData=e.data,t.locationBikeData.forEach((function(e,n){t.availabilityLocationBikeData.forEach((function(o){e.StationUID===o.StationUID&&(t.locationBikeData[n]=l(l({},e),o))}))})),t.renderBikeData(t.locationBikeData)}))}))},getAuthorizationHeader:function(){var t=(new Date).toGMTString(),e=new c.a("SHA-1","TEXT");e.setHMACKey("qd4_Nh2b30-edGu3vXmbDzaWTFU","TEXT"),e.update("x-date: ".concat(t));var n=e.getHMAC("B64");return{Authorization:'hmac username="'.concat("3209d3c409014e8cb42b5e83f861c102",'", algorithm="hmac-sha1", headers="x-date", signature="').concat(n,'"'),"X-Date":t}},setIconColor:function(t){return new this.leaflet.Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-".concat(t,".png"),iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]})},setLocation:function(){this.nowCityName="請選擇城市",this.cacheSearch="",this.myMap.setView([this.locationUser.latitude,this.locationUser.longitude],13),this.getLocationBikeData()},setStation:function(t){this.searchMarker&&this.myMap.removeLayer(this.searchMarker),this.myMap.setView([t.StationPosition.PositionLat,t.StationPosition.PositionLon],18),this.searchMarker=this.leaflet.marker([t.StationPosition.PositionLat,t.StationPosition.PositionLon],{icon:this.setIconColor("violet")}).bindPopup("<p>".concat(t.StationName.Zh_tw,"</p>\n            <p>營運狀態: ").concat(1===t.ServiceStatus?"正常營運":"暫停營運",'</p>\n            <p>可借數量: <span class="').concat(0===t.AvailableRentBikes?"text-warning":"text-success",'">').concat(t.AvailableRentBikes,' </span></p>\n            <p>可歸還量: <span class="').concat(0===t.AvailableReturnBikes?"text-danger":"text-success",'">').concat(t.AvailableReturnBikes,'</span></p>\n<a href="https://www.google.com.tw/maps/search/').concat(t.StationName.Zh_tw,'" target="_blank">Google 導航</a>')),this.searchMarker.addTo(this.myMap).openPopup()},changeCity:function(t){this.nowCityName=t,this.cacheSearch="";var e=this.cities.filter((function(e){return e.name===t}))[0];this.myMap.setView([e.coordinate.latitude,e.coordinate.longitude],13),this.getBikeData(e.nameEn)},renderBikeData:function(t){var e=this;this.markers&&this.myMap.removeLayer(this.markers),this.markers=this.leaflet.markerClusterGroup(),t.forEach((function(t){var n="";n=1===t.ServiceStatus&&t.AvailableRentBikes>0?"green":1===t.ServiceStatus&&0===t.AvailableRentBikes?"yellow":1===t.ServiceStatus&&0===t.AvailableReturnBikes?"red":"black",e.markers.addLayer(e.leaflet.marker([t.StationPosition.PositionLat,t.StationPosition.PositionLon],{icon:e.setIconColor(n)}).bindPopup("<p>".concat(t.StationName.Zh_tw,"</p>\n            <p>營運狀態: ").concat(1===t.ServiceStatus?"正常營運":"暫停營運",'</p>\n            <p>可借數量: <span class="').concat(0===t.AvailableRentBikes?"text-warning":"text-success",'">').concat(t.AvailableRentBikes,' </span></p>\n            <p>可歸還量: <span class="').concat(0===t.AvailableReturnBikes?"text-danger":"text-success",'">').concat(t.AvailableReturnBikes,'</span></p><a href="https://www.google.com.tw/maps/search/').concat(t.StationName.Zh_tw,'" target="_blank">Google 導航</a>')))})),this.myMap.addLayer(this.markers)}}},m=n(24),component=Object(m.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("figure",{staticClass:"banner banner__index magic-height-400 mb-8 mb-lg-15"},[n("div",{staticClass:"container h-100"},[n("div",{staticClass:"row align-items-center h-100"},[n("div",{staticClass:"col-md-6 mx-auto"},[n("h2",{staticClass:"text-center text-white mb-5"},[t._v("\n            尋找附近 U-Bike\n          ")]),t._v(" "),n("div",{staticClass:"p-5 bg-white rounded"},[n("div",{staticClass:"row g-2 mb-5"},[n("div",{staticClass:"col-lg-6"},[n("select",{staticClass:"form-select py-3 border-secondary",attrs:{"aria-label":"Default select example"},on:{change:function(e){return t.changeCity(e.target.value)}}},[n("option",{attrs:{hidden:"請選擇城市"!==t.nowCityName},domProps:{selected:"請選擇城市"===t.nowCityName}},[t._v("\n                    請選擇城市\n                  ")]),t._v(" "),t._l(t.cities,(function(e,o){return n("option",{key:e.name+o,domProps:{value:e.name,selected:e.name===t.nowCityName}},[t._v("\n                    "+t._s(e.name)+"\n                  ")])}))],2)]),t._v(" "),n("div",{staticClass:"col-lg-6 mb-5"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.cacheSearch,expression:"cacheSearch"}],staticClass:"form-control py-3 border-secondary",attrs:{placeholder:"請輸入站點名稱",disabled:"請選擇城市"===t.nowCityName},domProps:{value:t.cacheSearch},on:{input:function(e){e.target.composing||(t.cacheSearch=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"col-xl-6"},[n("button",{staticClass:"btn btn-lg btn-info me-5 d-flex align-items-center w-100",attrs:{type:"button"},on:{click:t.setLocation}},[n("span",{staticClass:"material-icons-outlined text-white me-3"},[t._v(" person_pin_circle ")]),t._v("\n                  以我的位置搜尋\n                ")])]),t._v(" "),t._m(0)])])])])])]),t._v(" "),n("section",{staticClass:"container mb-15"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-md-2 order-2 order-md-1"},[t._m(1),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.cacheSearch,expression:"cacheSearch"}],staticClass:"form-control py-3 mb-5 border-secondary text-center d-none d-lg-block",attrs:{placeholder:"請輸入站點名稱",disabled:"請選擇城市"===t.nowCityName},domProps:{value:t.cacheSearch},on:{input:function(e){e.target.composing||(t.cacheSearch=e.target.value)}}}),t._v(" "),t.cacheSearch?n("div",{staticClass:"d-none d-lg-block"},[n("p",{staticClass:"mb-3"},[t._v("\n            站點列表\n          ")]),t._v(" "),n("ul",{staticClass:"list-group list-group-flush overflow-auto magic-height-300 mb-5"},t._l(t.filterBikeData,(function(e){return n("li",{key:e.StationUID,staticClass:"list-group-item list-group-item-action",on:{click:function(n){return t.setStation(e)}}},[t._v("\n              "+t._s(e.StationName.Zh_tw)+"\n            ")])})),0)]):t._e()]),t._v(" "),n("div",{staticClass:"col-md-10 order-1 order-md-2"},[t.cacheSearch?n("div",{staticClass:"d-lg-none"},[n("p",{staticClass:"mb-3"},[t._v("\n            站點列表\n          ")]),t._v(" "),n("ul",{staticClass:"list-group list-group-flush overflow-auto magic-height-300 mb-5"},t._l(t.filterBikeData,(function(e){return n("li",{key:e.StationUID,staticClass:"list-group-item list-group-item-action",on:{click:function(n){return t.setStation(e)}}},[t._v("\n              "+t._s(e.StationName.Zh_tw)+"\n            ")])})),0)]):t._e(),t._v(" "),n("div",{ref:"mapID",staticClass:"magic-height-600",attrs:{id:"mapID"}})])])])])}),[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"col-xl-6 d-flex align-items-center"},[n("p",{staticClass:"text-danger d-flex align-items-center"},[n("span",{staticClass:"material-icons-outlined ms-4 me-3"},[t._v(" warning ")]),t._v("\n                  此功能需開啟定位\n                ")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{staticClass:"list-group list-group-flush"},[n("li",{staticClass:"\n              list-group-item list-group-item-action\n              d-flex\n              justify-content-center\n              align-items-center\n            "},[n("span",{staticClass:"material-icons-outlined text-info me-3"},[t._v(" person_pin_circle ")]),t._v(" "),n("p",[t._v("目前位置")])]),t._v(" "),n("li",{staticClass:"\n              list-group-item list-group-item-action\n              d-flex\n              justify-content-center\n              align-items-center\n            "},[n("span",{staticClass:"material-icons-outlined text-search me-3"},[t._v(" person_pin_circle ")]),t._v(" "),n("p",[t._v("搜尋位置")])]),t._v(" "),n("li",{staticClass:"\n              list-group-item list-group-item-action\n              d-flex\n              justify-content-center\n              align-items-center\n            "},[n("span",{staticClass:"material-icons-outlined text-success me-3"},[t._v(" location_on ")]),t._v(" "),n("p",[t._v("正常租借")])]),t._v(" "),n("li",{staticClass:"\n              list-group-item list-group-item-action\n              d-flex\n              justify-content-center\n              align-items-center\n            "},[n("span",{staticClass:"material-icons-outlined text-primary me-3"},[t._v(" location_on ")]),t._v(" "),n("p",[t._v("無車可借")])]),t._v(" "),n("li",{staticClass:"\n              list-group-item list-group-item-action\n              d-flex\n              justify-content-center\n              align-items-center\n            "},[n("span",{staticClass:"material-icons-outlined text-danger me-3"},[t._v(" location_on ")]),t._v(" "),n("p",[t._v("車位已滿")])]),t._v(" "),n("li",{staticClass:"\n              list-group-item list-group-item-action\n              d-flex\n              justify-content-center\n              align-items-center\n            "},[n("span",{staticClass:"material-icons-outlined text-dark me-3"},[t._v(" location_on ")]),t._v(" "),n("p",[t._v("暫停營運")])])])}],!1,null,null,null);e.default=component.exports}}]);